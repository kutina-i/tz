Задание 3: архитектура

Основные компоненты системы:

Микросервисы бэкенда  
Order Service — управляет заказами, отслеживает статус и время бездействия.
User Service — управляет данными пользователей, их предпочтениями.
Notification Management Service — отвечает за настройку, планирование и логику отправки уведомлений.
Campaign Service — управляет рекламными и промо-кампаниями, определяет, какие сообщения и когда отправлять.

Message Queue  
Kafka / RabbitMQ / Pulsar — для передачи событий между микросервисами, например, о статусе заказа, бездействии пользователя, запуске кампаний.

Scheduler / Cron Job Service
Планирует регулярные задачи, например, проверку бездействия корзин, запуск рекламных кампаний по расписанию.

Push Notification Service (PNS)  
Интегрирован с внешними платформами пуш-уведомлений:
Firebase Cloud Messaging (FCM) — для Android.
Apple Push Notification Service (APNs) — для iOS.
Получает сформированные сообщения от Notification Management Service и отправляет их в платформы пуш-уведомлений.

API Gateway  
Обеспечивает взаимодействие внешних систем и внутренних сервисов, а также клиентов.

Административный интерфейс  
Позволяет настраивать кампании, запускать рассылки, просматривать статистику.




Логика работы системы (последовательность):

Сбор событий и триггеров:  
Микросервисы (например, Order Service) отправляют события в Event Bus, такие как "Заказ без действия более 24 часов", "Заказ отменен", "Пользователь подписался на рассылку", или "Запуск рекламной кампании".

Обработка событий:  
Notification Management Service подписывается на события из Event Bus, обрабатывает их, принимает решения о необходимости отправки пуша.
Для регулярных проверок (например, "заказ слишком долго без действий") Scheduler запускает периодические задачи, которые инициируют соответствующие события.

Формирование сообщения:  
Для каждого события или кампании создается сообщение, которое содержит контент, целевую аудиторию, приоритет и т.д.

Отправка пуша:  
Notification Service передает сформированные сообщения в Push Notification Service.
PNS взаимодействует с внешними платформами (FCM, APNs), передает сообщения для доставки на устройства пользователей.

Получение и отображение пуша:  
Устройство пользователя получает пуш и отображает его согласно настройкам.

Блок-схема:

+------------------+        +----------------------+        +------------------+
|  Microservices   |        | Event Bus / MQ       |        | Scheduler / CRON |
| (Order, User,    | -----> | (Kafka, RabbitMQ)    | -----> | (Планировщик)    |
|  Campaign, etc.) |        +----------------------+        +------------------+
+------------------+                                         |
       |                                                    |
       |                                                    v
       |                                  +------------------------------+
       |                                  | Notification Management      |
       |                                  | Service                      |
       |                                  +------------------------------+
       |                                                    |
       |                                                    v
       |                                  +-----------------------------------+
       |                                  | Push Notification Service (PNS)   |
       |                                  |  (FCM, APNs интеграция)           |
       |                                  +-----------------------------------+
       |                                                    |
       +----------------------------------------------------+

